# 人大金仓数据卸载加载工具 - 管理控制台功能大纲
## 一、概述

### 1.1 系统定位

管理控制台（管控中心）是数据卸载加载工具的管理中心，提供**后台管理能力**（供前端页面/第三方系统调用），用于配置管理、任务监控和系统运维。
管控中心通过调度触发执行节点完成卸载/加载任务，并负责生成任务记录、批次号与配置快照等关键元数据。

### 1.2 核心功能

- **作业配置管理**: 维护卸载和加载作业的配置信息
- **表清单管理**: 维护需要处理的表清单和加载卸载策略
- **文件配置管理**: 配置非结构化文件的加载卸载规则
- **任务监控**: 实时监控任务执行状态和进度
- **执行历史查询**: 查询历史执行记录
- **手动操作**: 支持任务停止、重试等操作
- **交付物管理**: 查询/下载任务产物（如清单文件 `manifest.json`、日志、执行报告等）

---

## 二、作业配置管理

### 2.1 功能说明

维护各业务系统的卸载(EXPORT/EXTRACT)和加载(LOAD)作业，支持新增、编辑、启用/禁用、删除、连接测试等操作。

**主要配置项:**
- 基本信息: 作业编码、名称、类型、描述
- 数据源: 数据库地址、端口、库名、用户名密码
- 调度策略: 定时（Cron表达式/执行日历）或手动触发
- 运行参数: 作业内并发度、失败重试次数/间隔（可选）
- 目录与命名: 输出目录、批次号规则（批次号示例：`yyyyMMddHHmmss_001`）（可选）
- 安全配置: 是否启用加密、SM4密钥（若启用）

## 三、表清单配置管理

### 3.1 功能说明

以作业为维度维护需要卸载的表清单,支持增删改查、批量导入导出。

**表配置项:**
- 表名、表别名
- 抽取策略(全量FULL/增量INCREMENTAL)
- SQL(增量时必填)
- 是否启用、执行优先级
- （可选）接口映射: 表名/SQL名称 → 接口标识（用于生成标准文件名）

## 四、非结构化文件配置

### 4.1 功能说明

配置非结构化文件的卸载规则,支持两种方式:

**方式一: 关联表方式**
- 从数据库表查询文件列表
- 配置: 关联表名、路径字段、过滤条件

**方式二: 时间方式**
- 从文件系统扫描文件
- 配置: 文件目录、文件类型、时间范围

**预览功能:** 执行前预览文件列表、统计总数和大小
- **落盘规则（后台口径）:** 卸载时复制到工作目录并**保持相对路径结构**，便于加载端还原

## 五、任务监控

### 5.1 功能说明

实时监控任务执行状态,支持按作业、状态、批次号、时间范围等条件查询。

**展示信息:**
- 基本信息: 任务ID、作业名称、批次号、状态、进度
- 执行信息: 开始/结束时间、执行耗时
- 数据统计: 表数量、记录数、文件大小、压缩率、成功率等
- 执行节点: 执行节点名称（可选）
- 配置快照: 任务生成时保存配置快照（用于任务执行一致性）（可选展示）
- 阶段进度: 导出/采集/打包压缩/分片/加密/交付等阶段（可选）

**操作功能:** 停止、重试、查看日志、下载报告、删除任务

## 六、执行历史查询

### 6.1 功能说明

查询历史执行记录,支持按作业、状态、批次号、时间范围等条件查询。

**简单统计:**
- 按作业统计: 执行次数、成功率、平均耗时
- 按时间统计: 每日执行次数、成功率趋势

---

## 七、后台数据与交付物（简版口径）

### 7.1 任务与批次号

- **任务**: 一次作业触发生成一个任务实例（`task_id`），贯穿卸载/加载全流程。
- **批次号**: 用于唯一标识一次作业级的数据卸载/加载（示例：`20260119020000_001`），用于目录组织、文件命名与历史查询。
- **配置快照**: 任务生成时将作业配置序列化保存为 `config_snapshot`，保证任务执行期间配置一致。

### 7.2 清单文件（manifest.json）

- **定位**: 每个批次生成一个清单文件 `{作业名称}_{批次号}.manifest.json`，用于记录交付物清单、大小、摘要值等。
- **用途**: 加载端依据清单进行解密/校验/解包，拒绝不完整或被篡改的数据包。
- **内容（需求口径）**:
  - 基本信息：批次号、作业编码、作业类型（EXTRACT/LOAD）、生成时间、是否包含非结构化文件
  - 文件列表：文件名、大小、摘要值
  - 结构化数据摘要：表数量、总记录数、各表记录数明细（可选）
  - 非结构化文件摘要：采集方式、文件数量、总大小、类型统计、文件列表（可选）

### 7.3 目录结构（交付物）

- 工作目录形态（示例）：`{作业名称}/{批次号}/data/`（结构化数据文件）与 `files/`（非结构化文件，保持相对路径）
- 交付包形态：整体压缩包 `{作业名称}_{批次号}.tar.gz`，超过阈值时支持分片（如 `.001/.002/...`）

---

## 八、后台接口（简版，供需求评审/对接）

> 说明：以下为后台能力清单，不限定最终 URL 与参数细节；具体以接口文档为准。

### 8.1 作业配置管理

- **作业列表/详情**：按类型、状态分页查询；查看完整作业配置
- **作业新增/更新/删除**：维护作业元数据与启停状态
- **连接测试**：验证数据源/目标端连接可用性

### 8.2 配置管理（表清单/文件规则）

- **表清单维护**：查询、批量保存、导入导出（支持全量/增量 SQL）
- **非结构化规则维护**：保存关联表规则或时间扫描规则
- **文件采集预览**：按规则预演扫描，返回样本列表与统计（不落盘）

### 8.3 任务管理与监控

- **任务列表/详情**：按批次号、状态、时间范围查询；查看阶段进度与统计
- **任务控制**：停止、重试、删除（按权限）
- **执行历史**：历史查询与简单统计（成功率、耗时趋势等）

### 8.4 交付物与日志

- **日志查询/下载**：关键节点日志摘要、完整日志下载
- **清单查看/下载**：查看某批次的 `manifest.json`

### 8.5 脚本执行（可选）

- **自定义 SQL 执行**：用于单表维护/数据校验等（需严格权限与审计）
- **执行历史与结果**：记录执行人、时间、SQL、结果摘要与日志

